{"version":3,"file":"component.js","names":["Constructor","onMount","createEffect","onCleanup","$TRACK","createMemo","component","Base","args","context","kind","Error","Class","props","instance","keys","Object","equals","prev","next","length","i","l","prop","template"],"sources":["../src/component.ts"],"sourcesContent":["import {Constructor} from 'lowclass'\nimport {onMount, createEffect, onCleanup, type JSX, $TRACK, createMemo} from 'solid-js'\nimport type {DecoratorContext} from './decorators/types'\n\n// https://github.com/ryansolid/dom-expressions/pull/122\n\ninterface PossibleComponent {\n\tonMount?(): void\n\tonCleanup?(): void\n\ttemplate?(props: Record<string, unknown>): JSX.Element\n}\ninterface PossiblyReactiveConstructor {}\n\n/**\n * A decorator for using classes as Solid components.\n *\n * Example:\n *\n * > Note in the following example that `\\@` should be written as `@` without\n * the back slash. The back slash prevents JSDoc parsing errors in this comment\n * in TypeScript.  https://github.com/microsoft/TypeScript/issues/47679\n *\n * ```js\n * \\@component\n * \\@reactive\n * class MyComp {\n *   \\@signal last = 'none'\n *\n *   onMount() {\n *     console.log('mounted')\n *   }\n *\n *   template(props) {\n *     // here we use `props` passed in, or the signal on `this` which is also\n *     // treated as a prop\n *     return <h1>Hello, my name is {props.first} {this.last}</h1>\n *   }\n * }\n *\n * render(() => <MyComp first=\"Joe\" last=\"Pea\" />)\n * ```\n */\nexport function component<T extends Constructor>(Base: T, ...args: any): any {\n\tconst [context] = args as [DecoratorContext]\n\n\tif (typeof Base !== 'function' || (context && context.kind !== 'class'))\n\t\tthrow new Error('The @component decorator should only be used on a class.')\n\n\tconst Class = Constructor<PossibleComponent, PossiblyReactiveConstructor>(Base)\n\n\treturn function (props: Record<string | symbol, unknown>): JSX.Element {\n\t\tconst instance = new Class()\n\n\t\tconst keys = createMemo(\n\t\t\t() => {\n\t\t\t\tprops[$TRACK]\n\t\t\t\treturn Object.keys(props)\n\t\t\t},\n\t\t\t[],\n\t\t\t{\n\t\t\t\tequals(prev, next) {\n\t\t\t\t\tif (prev.length !== next.length) return false\n\t\t\t\t\tfor (let i = 0, l = prev.length; i < l; i += 1) if (prev[i] !== next[i]) return false\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t},\n\t\t)\n\n\t\tcreateEffect(() => {\n\t\t\tfor (const prop of keys()) {\n\t\t\t\tcreateEffect(() => {\n\t\t\t\t\t// @ts-expect-error\n\t\t\t\t\tinstance[prop] = props[prop]\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\n\t\tif (instance.onMount) onMount(() => instance.onMount?.())\n\t\tif (instance.onCleanup) onCleanup(() => instance.onCleanup?.())\n\n\t\treturn instance.template?.(props) ?? null\n\t}\n}\n\ndeclare module 'solid-js' {\n\tnamespace JSX {\n\t\t// Tells JSX what properties class components should have.\n\t\tinterface ElementClass {\n\t\t\ttemplate?(props: Record<string, unknown>): JSX.Element\n\t\t}\n\n\t\t// Tells JSX where to look up prop types on class components.\n\t\tinterface ElementAttributesProperty {\n\t\t\tPropTypes: {}\n\t\t}\n\t}\n}\n\nexport type Props<T extends object, K extends keyof T> = Pick<T, K> & {\n\tchildren?: JSX.Element\n}\n"],"mappings":"AAAA,SAAQA,WAAW,QAAO,UAAU;AACpC,SAAQC,OAAO,EAAEC,YAAY,EAAEC,SAAS,EAAYC,MAAM,EAAEC,UAAU,QAAO,UAAU;;AAGvF;;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,SAASA,CAAwBC,IAAO,EAAE,GAAGC,IAAS,EAAO;EAC5E,MAAM,CAACC,OAAO,CAAC,GAAGD,IAA0B;EAE5C,IAAI,OAAOD,IAAI,KAAK,UAAU,IAAKE,OAAO,IAAIA,OAAO,CAACC,IAAI,KAAK,OAAQ,EACtE,MAAM,IAAIC,KAAK,CAAC,0DAA0D,CAAC;EAE5E,MAAMC,KAAK,GAAGZ,WAAW,CAAiDO,IAAI,CAAC;EAE/E,OAAO,UAAUM,KAAuC,EAAe;IACtE,MAAMC,QAAQ,GAAG,IAAIF,KAAK,CAAC,CAAC;IAE5B,MAAMG,IAAI,GAAGV,UAAU,CACtB,MAAM;MACLQ,KAAK,CAACT,MAAM,CAAC;MACb,OAAOY,MAAM,CAACD,IAAI,CAACF,KAAK,CAAC;IAC1B,CAAC,EACD,EAAE,EACF;MACCI,MAAMA,CAACC,IAAI,EAAEC,IAAI,EAAE;QAClB,IAAID,IAAI,CAACE,MAAM,KAAKD,IAAI,CAACC,MAAM,EAAE,OAAO,KAAK;QAC7C,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEC,CAAC,GAAGJ,IAAI,CAACE,MAAM,EAAEC,CAAC,GAAGC,CAAC,EAAED,CAAC,IAAI,CAAC,EAAE,IAAIH,IAAI,CAACG,CAAC,CAAC,KAAKF,IAAI,CAACE,CAAC,CAAC,EAAE,OAAO,KAAK;QACrF,OAAO,IAAI;MACZ;IACD,CACD,CAAC;IAEDnB,YAAY,CAAC,MAAM;MAClB,KAAK,MAAMqB,IAAI,IAAIR,IAAI,CAAC,CAAC,EAAE;QAC1Bb,YAAY,CAAC,MAAM;UAClB;UACAY,QAAQ,CAACS,IAAI,CAAC,GAAGV,KAAK,CAACU,IAAI,CAAC;QAC7B,CAAC,CAAC;MACH;IACD,CAAC,CAAC;IAEF,IAAIT,QAAQ,CAACb,OAAO,EAAEA,OAAO,CAAC,MAAMa,QAAQ,CAACb,OAAO,GAAG,CAAC,CAAC;IACzD,IAAIa,QAAQ,CAACX,SAAS,EAAEA,SAAS,CAAC,MAAMW,QAAQ,CAACX,SAAS,GAAG,CAAC,CAAC;IAE/D,OAAOW,QAAQ,CAACU,QAAQ,GAAGX,KAAK,CAAC,IAAI,IAAI;EAC1C,CAAC;AACF"}