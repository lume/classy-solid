{"version":3,"file":"component.js","names":["Constructor","onMount","createEffect","onCleanup","$TRACK","createMemo","component","Base","context","kind","Error","Class","classComponentWrapper","props","instance","keys","Object","equals","prev","next","length","i","l","prop","ref","template","defineProperties","name","value","configurable","Symbol","hasInstance","obj"],"sources":["../../src/decorators/component.ts"],"sourcesContent":["import {Constructor} from 'lowclass/dist/Constructor.js'\nimport {onMount, createEffect, onCleanup, type JSX, $TRACK, createMemo} from 'solid-js'\nimport './metadata-shim.js'\n\n// https://github.com/ryansolid/dom-expressions/pull/122\n\ninterface PossibleComponent {\n\tonMount?(): void\n\tonCleanup?(): void\n\ttemplate?(props: Record<string, unknown>): JSX.Element\n}\ninterface PossiblyReactiveConstructor {}\n\n/**\n * A decorator for using classes as Solid components.\n *\n * Example:\n *\n * ```js\n * ⁣@component\n * class MyComp {\n *   ⁣@signal last = 'none'\n *\n *   onMount() {\n *     console.log('mounted')\n *   }\n *\n *   template(props) {\n *     // here we use `props` passed in, or the signal on `this` which is also\n *     // treated as a prop\n *     return <h1>Hello, my name is {props.first} {this.last}</h1>\n *   }\n * }\n *\n * render(() => <MyComp first=\"Joe\" last=\"Pea\" />)\n * ```\n */\nexport function component<T extends Constructor>(Base: T, context?: DecoratorContext): any {\n\tif (typeof Base !== 'function' || (context && context.kind !== 'class'))\n\t\tthrow new Error('The @component decorator should only be used on a class.')\n\n\tconst Class = Constructor<PossibleComponent, PossiblyReactiveConstructor>(Base)\n\n\t// Solid only undetstands function components, so we create a wrapper\n\t// function that instantiates the class and hooks up lifecycle methods and\n\t// props.\n\tfunction classComponentWrapper(props: Record<string | symbol, unknown>): JSX.Element {\n\t\tconst instance = new Class()\n\n\t\tconst keys = createMemo(\n\t\t\t() => {\n\t\t\t\tprops[$TRACK]\n\t\t\t\treturn Object.keys(props)\n\t\t\t},\n\t\t\t[],\n\t\t\t{\n\t\t\t\tequals(prev, next) {\n\t\t\t\t\tif (prev.length !== next.length) return false\n\t\t\t\t\tfor (let i = 0, l = prev.length; i < l; i += 1) if (prev[i] !== next[i]) return false\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t},\n\t\t)\n\n\t\tcreateEffect(() => {\n\t\t\t// @ts-expect-error index signature\n\t\t\tfor (const prop of keys()) createEffect(() => (instance[prop] = props[prop]))\n\t\t})\n\n\t\tonMount(() => {\n\t\t\tinstance.onMount?.()\n\n\t\t\tcreateEffect(() => {\n\t\t\t\tconst ref = props.ref as ((component: PossibleComponent) => void) | undefined\n\t\t\t\tref?.(instance)\n\t\t\t})\n\n\t\t\tonCleanup(() => instance.onCleanup?.())\n\t\t})\n\n\t\treturn instance.template?.(props) ?? null\n\t}\n\n\tObject.defineProperties(classComponentWrapper, {\n\t\tname: {\n\t\t\tvalue: Class.name,\n\t\t\tconfigurable: true,\n\t\t},\n\t\t[Symbol.hasInstance]: {\n\t\t\tvalue(obj: unknown) {\n\t\t\t\treturn obj instanceof Class\n\t\t\t},\n\t\t\tconfigurable: true,\n\t\t},\n\t})\n\n\treturn classComponentWrapper\n}\n\ndeclare module 'solid-js' {\n\tnamespace JSX {\n\t\t// Tells JSX what properties class components should have.\n\t\tinterface ElementClass {\n\t\t\ttemplate?(props: Record<string, unknown>): JSX.Element\n\t\t}\n\n\t\t// Tells JSX where to look up prop types on class components.\n\t\tinterface ElementAttributesProperty {\n\t\t\tPropTypes: {}\n\t\t}\n\t}\n}\n\nexport type Props<T extends object, K extends keyof T> = Pick<T, K> & {\n\tchildren?: JSX.Element\n\tref?: (component: T) => void\n}\n"],"mappings":"AAAA,SAAQA,WAAW,QAAO,8BAA8B;AACxD,SAAQC,OAAO,EAAEC,YAAY,EAAEC,SAAS,EAAYC,MAAM,EAAEC,UAAU,QAAO,UAAU;AACvF,OAAO,oBAAoB;;AAE3B;;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,SAASA,CAAwBC,IAAO,EAAEC,OAA0B,EAAO;EAC1F,IAAI,OAAOD,IAAI,KAAK,UAAU,IAAKC,OAAO,IAAIA,OAAO,CAACC,IAAI,KAAK,OAAQ,EACtE,MAAM,IAAIC,KAAK,CAAC,0DAA0D,CAAC;EAE5E,MAAMC,KAAK,GAAGX,WAAW,CAAiDO,IAAI,CAAC;;EAE/E;EACA;EACA;EACA,SAASK,qBAAqBA,CAACC,KAAuC,EAAe;IACpF,MAAMC,QAAQ,GAAG,IAAIH,KAAK,CAAC,CAAC;IAE5B,MAAMI,IAAI,GAAGV,UAAU,CACtB,MAAM;MACLQ,KAAK,CAACT,MAAM,CAAC;MACb,OAAOY,MAAM,CAACD,IAAI,CAACF,KAAK,CAAC;IAC1B,CAAC,EACD,EAAE,EACF;MACCI,MAAMA,CAACC,IAAI,EAAEC,IAAI,EAAE;QAClB,IAAID,IAAI,CAACE,MAAM,KAAKD,IAAI,CAACC,MAAM,EAAE,OAAO,KAAK;QAC7C,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEC,CAAC,GAAGJ,IAAI,CAACE,MAAM,EAAEC,CAAC,GAAGC,CAAC,EAAED,CAAC,IAAI,CAAC,EAAE,IAAIH,IAAI,CAACG,CAAC,CAAC,KAAKF,IAAI,CAACE,CAAC,CAAC,EAAE,OAAO,KAAK;QACrF,OAAO,IAAI;MACZ;IACD,CACD,CAAC;IAEDnB,YAAY,CAAC,MAAM;MAClB;MACA,KAAK,MAAMqB,IAAI,IAAIR,IAAI,CAAC,CAAC,EAAEb,YAAY,CAAC,MAAOY,QAAQ,CAACS,IAAI,CAAC,GAAGV,KAAK,CAACU,IAAI,CAAE,CAAC;IAC9E,CAAC,CAAC;IAEFtB,OAAO,CAAC,MAAM;MACba,QAAQ,CAACb,OAAO,GAAG,CAAC;MAEpBC,YAAY,CAAC,MAAM;QAClB,MAAMsB,GAAG,GAAGX,KAAK,CAACW,GAA2D;QAC7EA,GAAG,GAAGV,QAAQ,CAAC;MAChB,CAAC,CAAC;MAEFX,SAAS,CAAC,MAAMW,QAAQ,CAACX,SAAS,GAAG,CAAC,CAAC;IACxC,CAAC,CAAC;IAEF,OAAOW,QAAQ,CAACW,QAAQ,GAAGZ,KAAK,CAAC,IAAI,IAAI;EAC1C;EAEAG,MAAM,CAACU,gBAAgB,CAACd,qBAAqB,EAAE;IAC9Ce,IAAI,EAAE;MACLC,KAAK,EAAEjB,KAAK,CAACgB,IAAI;MACjBE,YAAY,EAAE;IACf,CAAC;IACD,CAACC,MAAM,CAACC,WAAW,GAAG;MACrBH,KAAKA,CAACI,GAAY,EAAE;QACnB,OAAOA,GAAG,YAAYrB,KAAK;MAC5B,CAAC;MACDkB,YAAY,EAAE;IACf;EACD,CAAC,CAAC;EAEF,OAAOjB,qBAAqB;AAC7B","ignoreList":[]}