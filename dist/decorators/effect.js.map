{"version":3,"file":"effect.js","names":["effectifyIfNeeded","finalizeMembersIfLast","getMemberStat","getMembers","effects__","effect","value","context","static","Error","kind","name","metadata","signalsAndMemos","stat","finalize","addInitializer","get","startEffects","obj","effects","stopEffects"],"sources":["../../src/decorators/effect.ts"],"sourcesContent":["import {effectifyIfNeeded, finalizeMembersIfLast, getMemberStat, getMembers, effects__} from '../_state.js'\nimport type {AnyObject, ClassySolidMetadata} from './types.js'\nimport './metadata-shim.js'\n\n/**\n * Decorator for making Solid.js effects out of methods or function-valued\n * properties. This is more convenient than calling `this.createEffect()` in the\n * constructor or a class method, reducing boilerplate. Pair this with `@signal`\n * and `@memo` to make reactive classes with less code.\n *\n * The `@effect` decorator can be used on methods or auto accessors. Methods are\n * the recommended usage.\n *\n * When used on auto accessors, the auto accessor value must be a function. Note\n * that currently the auto accessor function value cannot be changed (if you\n * change it, the new function will not be used).\n *\n * Example:\n *\n * ```ts\n * import { effect, signal, stopEffects } from 'classy-solid'\n * import { createSignal } from 'solid-js'\n *\n * const [a, setA] = createSignal(1)\n *\n * class Funkalicious {\n *   @signal b = 2\n *\n *   @effect logSum() {\n *     console.log('Sum:', a() + this.b)\n *   }\n *\n *   // Not recommended, but supported (more concise for simple effects):\n *   @effect accessor logA = () => console.log('a:', a())\n * }\n *\n * const fun = new Funkalicious() // logs \"Sum: 3\"\n *\n * setA(5) // logs \"Sum: 7\", \"a: 5\"\n * fun.b = 10 // logs \"Sum: 15\"\n *\n * // Later, clean up when done...\n * stopEffects(fun)\n * ```\n *\n * When extending from Effectful() or Effects, the `stopEffects` method can\n * be used instead of the standalone `stopEffects()` function:\n *\n * ```ts\n * import { effect, signal, Effects } from 'classy-solid'\n * import { createSignal } from 'solid-js'\n *\n * const [a, setA] = createSignal(1)\n *\n * class Funkalicious extends Effects {\n *   @signal b = 2\n *\n *   @effect logSum() {\n *     console.log('Sum:', a() + this.b)\n *   }\n * }\n *\n * const fun = new Funkalicious() // logs \"Sum: 3\"\n *\n * setA(5) // logs \"Sum: 7\"\n * fun.b = 10 // logs \"Sum: 15\"\n *\n * // Later, clean up when done...\n * fun.stopEffects()\n * ```\n */\n\nexport function effect(\n\tvalue: Function | ClassAccessorDecoratorTarget<unknown, () => void>,\n\tcontext: ClassMethodDecoratorContext | ClassAccessorDecoratorContext,\n) {\n\tif (context.static) throw new Error('@effect is not supported on static members.')\n\n\tconst {kind, name} = context\n\tconst metadata = context.metadata as ClassySolidMetadata\n\tconst signalsAndMemos = getMembers(metadata)\n\n\tif (!(kind === 'method' || kind === 'accessor'))\n\t\tthrow new Error('@effect can only be used on methods or function-valued accessors')\n\n\tconst stat =\n\t\tkind === 'accessor'\n\t\t\t? getMemberStat(name, 'effect-auto-accessor', signalsAndMemos)\n\t\t\t: getMemberStat(name, 'effect-method', signalsAndMemos)\n\n\tstat.finalize = function (this: unknown) {\n\t\teffectifyIfNeeded(this as AnyObject, name, stat)\n\t}\n\n\tcontext.addInitializer(function () {\n\t\tfinalizeMembersIfLast(this as AnyObject, signalsAndMemos)\n\t})\n\n\tif (kind === 'method') stat.value = value\n\telse if (kind === 'accessor') stat.value = (value as ClassAccessorDecoratorTarget<unknown, () => void>).get\n}\n\n/**\n * Starts all Solid.js effects created by the `@effect` decorator on the given\n * object. This can be used to restart effects that were previously stopped with\n * `stopEffects()`.\n *\n * Effects are created and started automatically, so this only needs to be\n * called if you have previously stopped the effects and want to start them\n * again.\n */\nexport function startEffects(obj: object) {\n\tlet effects = effects__.get(obj as AnyObject)\n\tif (!effects) return\n\teffects.startEffects()\n}\n\n/**\n * Stops all Solid.js effects created by the `@effect` decorator on the given\n * object. Use this once you are done with the instance and need to clean up.\n *\n * This does not needed to be used if the object is created in a reactive\n * context (such as inside a Solid.js component, or a nested effect), as those\n * effects will be cleaned up automatically when the owner context is cleaned\n * up.\n *\n * Effects that have been stopped can later be restarted by calling\n * `startEffects(obj)`.\n */\nexport function stopEffects(obj: object) {\n\tconst effects = effects__.get(obj as AnyObject)\n\tif (!effects) return\n\teffects.stopEffects()\n}\n"],"mappings":"AAAA,SAAQA,iBAAiB,EAAEC,qBAAqB,EAAEC,aAAa,EAAEC,UAAU,EAAEC,SAAS,QAAO,cAAc;AAE3G,OAAO,oBAAoB;;AAE3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAO,SAASC,MAAMA,CACrBC,KAAmE,EACnEC,OAAoE,EACnE;EACD,IAAIA,OAAO,CAACC,MAAM,EAAE,MAAM,IAAIC,KAAK,CAAC,6CAA6C,CAAC;EAElF,MAAM;IAACC,IAAI;IAAEC;EAAI,CAAC,GAAGJ,OAAO;EAC5B,MAAMK,QAAQ,GAAGL,OAAO,CAACK,QAA+B;EACxD,MAAMC,eAAe,GAAGV,UAAU,CAACS,QAAQ,CAAC;EAE5C,IAAI,EAAEF,IAAI,KAAK,QAAQ,IAAIA,IAAI,KAAK,UAAU,CAAC,EAC9C,MAAM,IAAID,KAAK,CAAC,kEAAkE,CAAC;EAEpF,MAAMK,IAAI,GACTJ,IAAI,KAAK,UAAU,GAChBR,aAAa,CAACS,IAAI,EAAE,sBAAsB,EAAEE,eAAe,CAAC,GAC5DX,aAAa,CAACS,IAAI,EAAE,eAAe,EAAEE,eAAe,CAAC;EAEzDC,IAAI,CAACC,QAAQ,GAAG,YAAyB;IACxCf,iBAAiB,CAAC,IAAI,EAAeW,IAAI,EAAEG,IAAI,CAAC;EACjD,CAAC;EAEDP,OAAO,CAACS,cAAc,CAAC,YAAY;IAClCf,qBAAqB,CAAC,IAAI,EAAeY,eAAe,CAAC;EAC1D,CAAC,CAAC;EAEF,IAAIH,IAAI,KAAK,QAAQ,EAAEI,IAAI,CAACR,KAAK,GAAGA,KAAK,MACpC,IAAII,IAAI,KAAK,UAAU,EAAEI,IAAI,CAACR,KAAK,GAAIA,KAAK,CAAuDW,GAAG;AAC5G;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,YAAYA,CAACC,GAAW,EAAE;EACzC,IAAIC,OAAO,GAAGhB,SAAS,CAACa,GAAG,CAACE,GAAgB,CAAC;EAC7C,IAAI,CAACC,OAAO,EAAE;EACdA,OAAO,CAACF,YAAY,CAAC,CAAC;AACvB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASG,WAAWA,CAACF,GAAW,EAAE;EACxC,MAAMC,OAAO,GAAGhB,SAAS,CAACa,GAAG,CAACE,GAAgB,CAAC;EAC/C,IAAI,CAACC,OAAO,EAAE;EACdA,OAAO,CAACC,WAAW,CAAC,CAAC;AACtB","ignoreList":[]}