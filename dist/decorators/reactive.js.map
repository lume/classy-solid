{"version":3,"file":"reactive.js","names":["getListener","untrack","getKey","getPropsToSignalify","resetPropsToSignalify","getCreateSignalAccessor","accessKey","createSignalAccessor","hasOwnProperty","Object","prototype","reactive","args","value","context","kind","TypeError","Class","props","ReactiveDecorator","constructor","instance","Reflect","construct","new","target","prop","initialValue","call","Error","toString"],"sources":["../../src/decorators/reactive.ts"],"sourcesContent":["import type {Constructor} from 'lowclass'\nimport {getListener, untrack} from 'solid-js'\nimport {getKey, getPropsToSignalify, resetPropsToSignalify} from './signal.js'\nimport {getCreateSignalAccessor} from '../signalify.js'\nimport type {DecoratedValue, DecoratorContext} from './types.js'\n\n/**\n * Access key for classy-solid private internal APIs.\n */\nconst accessKey = getKey()\n\nconst createSignalAccessor = getCreateSignalAccessor()\nconst hasOwnProperty = Object.prototype.hasOwnProperty\n\n/**\n * A decorator that makes a class reactive, allowing it have properties\n * decorated with `@signal` to make those properties reactive Solid signals.\n *\n * Example:\n *\n * > Note in the following example that `\\@` should be written as `@` without\n * the back slash. The back slash prevents JSDoc parsing errors in this comment\n * in TypeScript.  https://github.com/microsoft/TypeScript/issues/47679\n *\n * ```js\n * import {reactive, signal} from 'classy-solid'\n * import {createEffect} from 'solid-js'\n *\n * \\@reactive\n * class Counter {\n *   \\@signal count = 0\n *\n *   constructor() {\n *     setInterval(() => this.count++, 1000)\n *   }\n * }\n *\n * const counter = new Counter\n *\n * createEffect(() => {\n *   console.log('count:', counter.count)\n * })\n * ```\n */\nexport function reactive(...args: any[]): any {\n\tconst [value, context] = args as [DecoratedValue, DecoratorContext]\n\n\tif (typeof value !== 'function' || (context && context.kind !== 'class'))\n\t\tthrow new TypeError('The @reactive decorator is only for use on classes.')\n\n\tconst Class = value as Constructor\n\tconst props = getPropsToSignalify(accessKey)\n\n\t// For the current class decorated with @reactive, we reset the map, so that\n\t// for the next class decorated with @reactive we track only that next\n\t// class's properties that were decorated with @signal. We do this because\n\t// field decorators do not have access to the class or its prototype.\n\t//\n\t// In the future maybe we can use decorator metadata for this\n\t// (https://github.com/tc39/proposal-decorator-metadata)?\n\tresetPropsToSignalify(accessKey)\n\n\tclass ReactiveDecorator extends Class {\n\t\tconstructor(...args: any[]) {\n\t\t\tlet instance!: ReactiveDecorator\n\n\t\t\tif (getListener()) untrack(() => (instance = Reflect.construct(Class, args, new.target))) // super()\n\t\t\telse super(...args), (instance = this)\n\n\t\t\tfor (const [prop, {initialValue}] of props) {\n\t\t\t\t// @prod-prune\n\t\t\t\tif (!(hasOwnProperty.call(instance, prop) || hasOwnProperty.call(Class.prototype, prop))) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Property \"${prop.toString()}\" not found on instance of class decorated with \\`@reactive\\`. Did you forget to use the \\`@reactive\\` decorator on one of your classes that has a \"${prop.toString()}\" property decorated with \\`@signal\\`?`,\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\tcreateSignalAccessor(instance, prop as Exclude<keyof ReactiveDecorator, number>, initialValue)\n\t\t\t}\n\n\t\t\treturn instance\n\t\t}\n\t}\n\n\treturn ReactiveDecorator\n}\n"],"mappings":"AACA,SAAQA,WAAW,EAAEC,OAAO,QAAO,UAAU;AAC7C,SAAQC,MAAM,EAAEC,mBAAmB,EAAEC,qBAAqB,QAAO,aAAa;AAC9E,SAAQC,uBAAuB,QAAO,iBAAiB;AAGvD;AACA;AACA;AACA,MAAMC,SAAS,GAAGJ,MAAM,CAAC,CAAC;AAE1B,MAAMK,oBAAoB,GAAGF,uBAAuB,CAAC,CAAC;AACtD,MAAMG,cAAc,GAAGC,MAAM,CAACC,SAAS,CAACF,cAAc;;AAEtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASG,QAAQA,CAAC,GAAGC,IAAW,EAAO;EAC7C,MAAM,CAACC,KAAK,EAAEC,OAAO,CAAC,GAAGF,IAA0C;EAEnE,IAAI,OAAOC,KAAK,KAAK,UAAU,IAAKC,OAAO,IAAIA,OAAO,CAACC,IAAI,KAAK,OAAQ,EACvE,MAAM,IAAIC,SAAS,CAAC,qDAAqD,CAAC;EAE3E,MAAMC,KAAK,GAAGJ,KAAoB;EAClC,MAAMK,KAAK,GAAGf,mBAAmB,CAACG,SAAS,CAAC;;EAE5C;EACA;EACA;EACA;EACA;EACA;EACA;EACAF,qBAAqB,CAACE,SAAS,CAAC;EAEhC,MAAMa,iBAAiB,SAASF,KAAK,CAAC;IACrCG,WAAWA,CAAC,GAAGR,IAAW,EAAE;MAC3B,IAAIS,QAA4B;MAEhC,IAAIrB,WAAW,CAAC,CAAC,EAAEC,OAAO,CAAC,MAAOoB,QAAQ,GAAGC,OAAO,CAACC,SAAS,CAACN,KAAK,EAAEL,IAAI,EAAEY,GAAG,CAACC,MAAM,CAAE,CAAC,EAAC;MAAA,KACrF,KAAK,CAAC,GAAGb,IAAI,CAAC,EAAGS,QAAQ,GAAG,IAAK;MAEtC,KAAK,MAAM,CAACK,IAAI,EAAE;QAACC;MAAY,CAAC,CAAC,IAAIT,KAAK,EAAE;QAC3C;QACA,IAAI,EAAEV,cAAc,CAACoB,IAAI,CAACP,QAAQ,EAAEK,IAAI,CAAC,IAAIlB,cAAc,CAACoB,IAAI,CAACX,KAAK,CAACP,SAAS,EAAEgB,IAAI,CAAC,CAAC,EAAE;UACzF,MAAM,IAAIG,KAAK,CACb,aAAYH,IAAI,CAACI,QAAQ,CAAC,CAAE,uJAAsJJ,IAAI,CAACI,QAAQ,CAAC,CAAE,wCACpM,CAAC;QACF;QAEAvB,oBAAoB,CAACc,QAAQ,EAAEK,IAAI,EAA8CC,YAAY,CAAC;MAC/F;MAEA,OAAON,QAAQ;IAChB;EACD;EAEA,OAAOF,iBAAiB;AACzB"}