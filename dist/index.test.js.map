{"version":3,"file":"index.test.js","names":["createComputed","createRoot","Effectful","effect","memo","signal","startEffects","stopEffects","testButterflyProps","b","initialColors","count","colors","wingSize","expect","toBe","MyElement","_Effectful","HTMLElement","_init_a","_init_extra_a","_init_b","_init_extra_b","_applyDecs","e","customElements","define","a","runs","result","connectedCallback","createEffect","disconnectedCallback","clearEffects","MyElement2","_Effectful2","_init_a2","_init_extra_a2","_init_b2","_init_extra_b2","constructor","MyElement3","_Effectful3","_init_a3","_init_extra_a3","_init_b3","_init_extra_b3","_initProto","args","sum","log","MyElement4","_HTMLElement","_init_a4","_init_extra_a4","_init_b4","_init_extra_b4","_initProto2","testElementEffects","el","document","body","append","removeChild"],"sources":["../src/index.test.ts"],"sourcesContent":["import {createComputed, createRoot} from 'solid-js'\nimport {Effectful} from './mixins/index.js'\nimport {effect, memo, signal, startEffects, stopEffects} from './decorators/index.js'\n\n// TODO move type def to @lume/cli, map @types/jest's `expect` type into the\n// global env.\ndeclare global {\n\tfunction expect(...args: any[]): any\n}\n\n// Test helper shared with other test files.\nexport function testButterflyProps(b: {colors: number; wingSize: number}, initialColors = 3) {\n\tlet count = 0\n\n\tcreateRoot(() => {\n\t\tcreateComputed(() => {\n\t\t\tb.colors\n\t\t\tb.wingSize\n\t\t\tcount++\n\t\t})\n\t})\n\n\texpect(b.colors).toBe(initialColors, 'initial colors value')\n\texpect(b.wingSize).toBe(2, 'initial wingSize value')\n\texpect(count).toBe(1, 'Should be reactive')\n\n\tb.colors++\n\n\texpect(b.colors).toBe(initialColors + 1, 'incremented colors value')\n\texpect(count).toBe(2, 'Should be reactive')\n\n\tb.wingSize++\n\n\texpect(b.wingSize).toBe(3, 'incremented wingSize value')\n\texpect(count).toBe(3, 'Should be reactive')\n}\n\nexport class MyElement extends Effectful(HTMLElement) {\n\tstatic {\n\t\tcustomElements.define('my-element', this)\n\t}\n\n\t@signal a = 1\n\t@signal b = 2\n\n\truns = 0\n\tresult = 0\n\n\tconnectedCallback() {\n\t\tthis.createEffect(() => {\n\t\t\tthis.runs++\n\t\t\tthis.result = this.a + this.b\n\t\t})\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis.clearEffects()\n\t}\n}\n\nexport class MyElement2 extends Effectful(HTMLElement) {\n\tstatic {\n\t\tcustomElements.define('my-element2', this)\n\t}\n\n\t@signal a = 1\n\t@signal b = 2\n\n\truns = 0\n\tresult = 0\n\n\tconstructor() {\n\t\tsuper()\n\t\tthis.createEffect(() => {\n\t\t\tthis.runs++\n\t\t\tthis.result = this.a + this.b\n\t\t})\n\t}\n\n\tconnectedCallback() {\n\t\tthis.startEffects()\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis.stopEffects()\n\t}\n}\n\nexport class MyElement3 extends Effectful(HTMLElement) {\n\tstatic {\n\t\tcustomElements.define('my-element3', this)\n\t}\n\n\truns = 0\n\tresult = 0\n\n\t@signal a = 1\n\t@signal b = 2\n\n\t@memo get sum() {\n\t\treturn this.a + this.b\n\t}\n\n\t@effect log() {\n\t\tthis.runs++\n\t\tthis.result = this.sum\n\t}\n\n\tconnectedCallback() {\n\t\tthis.startEffects()\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis.stopEffects()\n\t}\n}\nexport class MyElement4 extends HTMLElement {\n\tstatic {\n\t\tcustomElements.define('my-element4', this)\n\t}\n\n\truns = 0\n\tresult = 0\n\n\t@signal a = 1\n\t@signal b = 2\n\n\t@memo get sum() {\n\t\treturn this.a + this.b\n\t}\n\n\t@effect log() {\n\t\tthis.runs++\n\t\tthis.result = this.sum\n\t}\n\n\tconnectedCallback() {\n\t\tstartEffects(this)\n\t}\n\n\tdisconnectedCallback() {\n\t\tstopEffects(this)\n\t}\n}\n\nexport function testElementEffects(el: Element & {a: number; b: number; result: number; runs: number}) {\n\tdocument.body.append(el) // triggers connectedCallback\n\n\texpect(el.result).toBe(1 + 2)\n\texpect(el.runs).toBe(1)\n\n\tel.a = 5\n\texpect(el.result).toBe(5 + 2)\n\texpect(el.runs).toBe(2)\n\n\tel.b = 10\n\texpect(el.result).toBe(5 + 10)\n\texpect(el.runs).toBe(3)\n\n\t// disconnect the element\n\n\tdocument.body.removeChild(el) // triggers disconnectedCallback\n\n\t// Further signal changes do not affect result while disconnected\n\tel.a = 20\n\tel.b = 30\n\texpect(el.result).toBe(5 + 10)\n\texpect(el.runs).toBe(3)\n\n\t// reconnect the element\n\tdocument.body.append(el) // triggers connectedCallback\n\texpect(el.result).toBe(20 + 30)\n\texpect(el.runs).toBe(4)\n\n\t// further signal changes work again\n\tel.a = 100\n\texpect(el.result).toBe(100 + 30)\n\texpect(el.runs).toBe(5)\n\tel.b = 200\n\texpect(el.result).toBe(100 + 200)\n\texpect(el.runs).toBe(6)\n}\n"],"mappings":"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","ignoreList":[]}